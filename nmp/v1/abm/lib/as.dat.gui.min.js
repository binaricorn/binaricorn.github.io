(function(){ABM.DatGUI=function(){function DatGUI(fbuiOrModel,uiObject){ABM.Util.mixin(this,new ABM.Evented);this.gui=new dat.GUI;this.datGuiModel={};this.datGuiControllers={};var model,ui,fbui;if(arguments.length==2){model=this.model=fbuiOrModel;ui=this.ui=uiObject}else{fbui=this.fbui=fbuiOrModel;ui=this.ui=fbui.ui}this.initUIElements(ui,this.gui)}DatGUI.prototype.initUIElements=function(ui,folder){var self=this;for(var name in ui){if(ui.hasOwnProperty(name)){var uiEl=ui[name];if(isFolder(uiEl)){var subFolder=folder.addFolder(name);this.initUIElements(uiEl,subFolder);continue}if(uiEl.type!="button"){this.datGuiModel[name]=uiEl.val;if(typeof fbui!="undefined"){fbui.refs[name].child("val").on("value",function(valSnap){self.datGuiModel[this.name]=valSnap.val();self.updateGui()}.bind({name:name}))}}var ctrl=null;switch(uiEl.type){case"button":this.datGuiModel[name]=self.fbui?function(){self.fbui.setUIValue(this.name,true)}.bind({name:name}):function(){self.setModelValue(this.name,null,this.setter)}.bind({name:name,setter:ui[name].setter});folder.add(this.datGuiModel,name);break;case"choice":ctrl=folder.add(this.datGuiModel,name,uiEl.vals);break;case"switch":ctrl=folder.add(this.datGuiModel,name);break;case"slider":ctrl=folder.add(this.datGuiModel,name,uiEl.min,uiEl.max).step(uiEl.step);break}if(ctrl){var callback;if(self.fbui){callback=function(value){self.fbui.setUIValue(this.name,value)}.bind({name:name})}else{callback=function(value){self.setModelValue(this.name,value,this.setter)}.bind({name:name,setter:ui[name].setter})}if(uiEl.smooth){ctrl.onChange(callback)}else{ctrl.onFinishChange(callback)}this.datGuiControllers[name]=ctrl}}}};DatGUI.prototype.setModelValue=function(name,value,setter){if(setter){this.model[setter](value)}else{this.model[name]=value}this.emit("change",{name:name,value:value})};DatGUI.prototype.update=function(uiObject){for(var name in uiObject){var curCtrl=this.datGuiControllers[name];if(curCtrl){curCtrl.setValue(uiObject[name]);var changeFun=curCtrl.__onChange||curCtrl.__onFinishChange;changeFun(this.datGuiModel[name])}}};DatGUI.prototype.updateGui=function(){for(var i in this.gui.__controllers){this.gui.__controllers[i].updateDisplay()}};function isFolder(obj){return typeof obj.type=="undefined"}return DatGUI}()}).call(this);