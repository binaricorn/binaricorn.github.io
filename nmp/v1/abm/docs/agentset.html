<!DOCTYPE html>

<html>
<head>
  <title>agentset.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="agentset.html">
                  agentset.coffee
                </a>
              
                
                <a class="source" href="animator.html">
                  animator.coffee
                </a>
              
                
                <a class="source" href="color.html">
                  color.coffee
                </a>
              
                
                <a class="source" href="colormaps.html">
                  colormaps.coffee
                </a>
              
                
                <a class="source" href="colormixin.html">
                  colormixin.coffee
                </a>
              
                
                <a class="source" href="evented.html">
                  evented.coffee
                </a>
              
                
                <a class="source" href="link.html">
                  link.coffee
                </a>
              
                
                <a class="source" href="links.html">
                  links.coffee
                </a>
              
                
                <a class="source" href="model.html">
                  model.coffee
                </a>
              
                
                <a class="source" href="patch.html">
                  patch.coffee
                </a>
              
                
                <a class="source" href="patches.html">
                  patches.coffee
                </a>
              
                
                <a class="source" href="shapes.html">
                  shapes.coffee
                </a>
              
                
                <a class="source" href="turtle.html">
                  turtle.coffee
                </a>
              
                
                <a class="source" href="turtles.html">
                  turtles.coffee
                </a>
              
                
                <a class="source" href="util.html">
                  util.coffee
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>agentset.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>An <strong>AgentSet</strong> is an array, along with a class, agentClass, whose instances
are the items of the array.  Instances of the class are created
by the <code>create</code> factory method of an AgentSet.</p>
<p>It is a subclass of <code>Array</code> and is the base class for
<code>Patches</code>, <code>Turtles</code>, and <code>Links</code>. An AgentSet keeps track of all
its created instances.  It also provides, much like the <strong>Util</strong>
module, many methods shared by all subclasses of AgentSet.</p>
<p>A model contains three agentsets:</p>
<ul>
<li><code>patches</code>: the model’s “world” grid</li>
<li><code>turtles</code>: the model’s turtles living on the patches</li>
<li><code>links</code>: the network links connecting agent pairs</li>
</ul>
<p>See NetLogo <a href="http://ccl.northwestern.edu/netlogo/docs/">documentation</a>
for explanation of the overall semantics of Agent Based Modeling
used by AgentSets as well as Patches, Turtles, and Links.</p>
<p>Note: subclassing <code>Array</code> can be dangerous and we may have to convert
to a different style. See Trevor Burnham’s <a href="http://goo.gl/Lca8g">comments</a>
but thus far we’ve resolved all related problems.</p>
<p>Because we are an array subset, @[i] == this[i] == agentset[i]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AgentSet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Array</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h3 id="static-members">Static members</h3>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><code>asSet</code> is a static wrapper function converting an array of agents into
an <code>AgentSet</code> .. except for the ID which only impacts the add method.
It is primarily used to turn a comprehension into an AgentSet instance
which then gains access to all the methods below.  Ex:</p>
<pre><code>evens = (a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> @model.turtles <span class="hljs-keyword">when</span> a.id % <span class="hljs-number">2</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>)
ABM.AgentSet.asSet(evens)
randomEven = evens.oneOf()
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  @asSet: <span class="hljs-function"><span class="hljs-params">(a, setType = AgentSet)</span> -&gt;</span> <span class="hljs-comment">#(a, setType = ABM.AgentSet)</span>
    a.__proto__ = setType.prototype ? setType.constructor.prototype <span class="hljs-comment"># setType.__proto__</span>
    a.model=a[<span class="hljs-number">0</span>].model <span class="hljs-keyword">if</span> a[<span class="hljs-number">0</span>]? <span class="hljs-comment"># Used by geometric methods</span>
    a</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>In the examples below, we’ll use an array of primitive agent objects
with three fields: id, x, y.</p>
<pre><code>AS = <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span><span class="hljs-number">.5</span>] <span class="hljs-comment"># long form comprehension</span>
  {id:i, x:u.randomInt(<span class="hljs-number">10</span>), y:u.randomInt(<span class="hljs-number">10</span>)}
ABM.AgentSet.asSet AS <span class="hljs-comment"># Convert AS to AgentSet in place</span>
   [{id:<span class="hljs-number">1</span>,x:<span class="hljs-number">0</span>,y:<span class="hljs-number">1</span>}, {id:<span class="hljs-number">2</span>,x:<span class="hljs-number">8</span>,y:<span class="hljs-number">0</span>}, {id:<span class="hljs-number">3</span>,x:<span class="hljs-number">6</span>,y:<span class="hljs-number">4</span>},
    {id:<span class="hljs-number">4</span>,x:<span class="hljs-number">1</span>,y:<span class="hljs-number">3</span>}, {id:<span class="hljs-number">5</span>,x:<span class="hljs-number">1</span>,y:<span class="hljs-number">1</span>}]
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3 id="constructor-and-add-remove-agents-">Constructor and add/remove agents.</h3>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Create an empty <code>AgentSet</code> and initialize the <code>ID</code> counter for add().
If mainSet is supplied, the new agentset is a sub-array of mainSet.
This sub-array feature is how breeds are managed, see class <code>Model</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-params">(@model, @agentClass, @name, @mainSet)</span> -&gt;</span>
    <span class="hljs-keyword">super</span>(<span class="hljs-number">0</span>) <span class="hljs-comment"># doesn't yield empty array if already instances in the mainSet</span>
    u.mixin(@, <span class="hljs-keyword">new</span> Evented())
    @breeds = [] <span class="hljs-keyword">unless</span> @mainSet?
    @agentClass::breed = @ <span class="hljs-comment"># let the breed know I'm it's agentSet</span>
    @agentClass::model = @model <span class="hljs-comment"># let the breed know its model</span>
    @ownVariables = [] <span class="hljs-comment"># keep list of user variables</span>
    @ID = <span class="hljs-number">0</span> <span class="hljs-keyword">unless</span> @mainSet? <span class="hljs-comment"># Do not set ID if I'm a subset</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Abstract method used by subclasses to create and add their instances.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  create: <span class="hljs-function">-&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Add an agent to the list.  Only used by agentset factory methods. Adds
the <code>id</code> property to all agents. Increment <code>ID</code>.
Returns the object for chaining. The set will be sorted by <code>id</code>.</p>
<p>By “agent” we mean an instance of <code>Patch</code>, <code>Turtle</code> and <code>Link</code> and their breeds</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  add: <span class="hljs-function"><span class="hljs-params">(o)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> @mainSet? <span class="hljs-keyword">then</span> @mainSet.add o <span class="hljs-keyword">else</span> o.id = @ID++
    @push o; o</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Remove an agent from the agentset, returning the agentset.
Note this does not change ID, thus an
agentset can have gaps in terms of their ids. Assumes set is
sorted by <code>id</code>. If the set is one created by <code>asSet</code>, and the original
array is unsorted, simply call <code>sortById</code> first, see <code>sortById</code> below.</p>
<pre><code>AS.remove(AS[<span class="hljs-number">3</span>]) <span class="hljs-comment"># [{id:0,x:0,y:1}, {id:1,x:8,y:0},</span>
                    {id:<span class="hljs-number">2</span>,x:<span class="hljs-number">6</span>,y:<span class="hljs-number">4</span>}, {id:<span class="hljs-number">4</span>,x:<span class="hljs-number">1</span>,y:<span class="hljs-number">1</span>}]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  remove: <span class="hljs-function"><span class="hljs-params">(o)</span> -&gt;</span>
    u.removeItem @mainSet, o <span class="hljs-keyword">if</span> @mainSet?
    u.removeItem @, o
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Set/get the default value of an agent class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setDefault: <span class="hljs-function"><span class="hljs-params">(name, value)</span> -&gt;</span> @agentClass::[name] = value
  getDefault: <span class="hljs-function"><span class="hljs-params">(name)</span> -&gt;</span> @agentClass::[name]</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Declare variables of an agent class.
Vars = a string of space separated names or an array of name strings
Return agentset.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  own: <span class="hljs-function"><span class="hljs-params">(vars)</span> -&gt;</span> <span class="hljs-comment"># maybe not set default if val is null?</span>
    <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> vars.split(<span class="hljs-string">" "</span>)
      @setDefault name, <span class="hljs-literal">null</span>
      @ownVariables.push name
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Move an agent from its AgentSet/breed to be in this AgentSet/breed.
REMIND: match NetLogo sematics in terms of own variables.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setBreed: <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span> <span class="hljs-comment"># change agent a to be in this breed</span>
    u.removeItem a.breed, a, <span class="hljs-string">"id"</span> <span class="hljs-keyword">if</span> a.breed.mainSet?
    u.insertItem @, a, <span class="hljs-string">"id"</span> <span class="hljs-keyword">if</span> @mainSet?
    proto = a.__proto__ = @agentClass.prototype
    <span class="hljs-keyword">delete</span> a[k] <span class="hljs-keyword">for</span> own k,v <span class="hljs-keyword">of</span> a <span class="hljs-keyword">when</span> proto[k]?
    a</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Return all agents that are not of the given breeds argument.
Breeds is a string of space separated names:
  @patches.exclude “roads houses”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exclude: <span class="hljs-function"><span class="hljs-params">(breeds)</span> -&gt;</span> <span class="hljs-comment"># Not used, remove??</span>
    breeds = breeds.split(<span class="hljs-string">" "</span>)
    @asSet (o <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> o.breed.name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> breeds)</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Remove adjacent duplicates, by reference, in a sorted agentset.
Use <code>sortById</code> first if agentset not sorted.</p>
<pre><code>as = (AS.oneOf() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span><span class="hljs-number">.4</span>]) <span class="hljs-comment"># 4 random agents w/ dups</span>
ABM.AgentSet.asSet as <span class="hljs-comment"># [{id:1,x:8,y:0}, {id:0,x:0,y:1},</span>
                         {id:<span class="hljs-number">0</span>,x:<span class="hljs-number">0</span>,y:<span class="hljs-number">1</span>}, {id:<span class="hljs-number">2</span>,x:<span class="hljs-number">6</span>,y:<span class="hljs-number">4</span>}]
as.sortById().uniq() <span class="hljs-comment"># [{id:0,x:0,y:1}, {id:1,x:8,y:0},</span>
                        {id:<span class="hljs-number">2</span>,x:<span class="hljs-number">6</span>,y:<span class="hljs-number">4</span>}]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  uniq: <span class="hljs-function">-&gt;</span> u.uniq(@)</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>The static <code>ABM.AgentSet.asSet</code> as a method.
Used by agentset methods creating new agentsets.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  asSet: <span class="hljs-function"><span class="hljs-params">(a, setType = AgentSet)</span> -&gt;</span> AgentSet.asSet a, setType <span class="hljs-comment"># setType = AgentSet</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Is the given array an agentset of the given type?
It does not use the prototype chain, so</p>
<pre><code>isSet(turtles, <span class="hljs-string">"AgentSet"</span>)
</code></pre><p>is false. Current names: AgentSet, Turtles, Patches, Links.
Default name is “AgentSet”, good test for derived sets using asSet()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isSet: <span class="hljs-function"><span class="hljs-params">(name = <span class="hljs-string">"AgentSet"</span>)</span> -&gt;</span>  @constructor.name <span class="hljs-keyword">is</span> name</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Similar for above but includes breeds of Turtles, Patches, Links too
isBreed(“Turtles”) returns true for an agent that isn’t a breed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isBreed: <span class="hljs-function"><span class="hljs-params">(name)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>@isSet(name) or (@agentClass?.name is name)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> @agentClass? <span class="hljs-keyword">then</span> (@agentClass.name <span class="hljs-keyword">is</span> name) <span class="hljs-keyword">else</span> @isSet(name)</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Similar to above but sorted via <code>id</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  asOrderedSet: <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span> @asSet(a).sortById()</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Return string representative of agentset.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  toString: <span class="hljs-function">-&gt;</span> <span class="hljs-string">"["</span>+(a.toString() <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> @).join(<span class="hljs-string">", "</span>)+<span class="hljs-string">"]"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h3 id="property-utilities">Property Utilities</h3>
<p>Property access, also useful for debugging<br></p>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Return an array of a property of the agentset</p>
<pre><code> AS.getProp <span class="hljs-string">"x"</span> <span class="hljs-comment"># [0, 8, 6, 1, 1]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  getProp: <span class="hljs-function"><span class="hljs-params">(prop)</span> -&gt;</span> u.aProp(@, prop)</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Return an array of agents with the property equal to the given value</p>
<pre><code>AS.getPropWith <span class="hljs-string">"x"</span>, <span class="hljs-number">1</span>
[{id:<span class="hljs-number">4</span>,x:<span class="hljs-number">1</span>,y:<span class="hljs-number">3</span>},{id:<span class="hljs-number">5</span>,x:<span class="hljs-number">1</span>,y:<span class="hljs-number">1</span>}]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  getPropWith: <span class="hljs-function"><span class="hljs-params">(prop, value)</span> -&gt;</span> @asSet (o <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> o[prop] <span class="hljs-keyword">is</span> value)</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Set the property of the agents to a given value.  If value
is an array, its values will be used, indexed by agentSet’s index.
This is generally used via: getProp, modify results, setProp</p>
<pre><code><span class="hljs-comment"># increment x for agents with x=1</span>
AS1 = ABM.AgentSet.asSet AS.getPropWith(<span class="hljs-string">"x"</span>,<span class="hljs-number">1</span>)
AS1.setProp <span class="hljs-string">"x"</span>, <span class="hljs-number">2</span> <span class="hljs-comment"># {id:4,x:2,y:3},{id:5,x:2,y:1}</span>
</code></pre><p>Note this changes the last two objects in the original AS above</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setProp: <span class="hljs-function"><span class="hljs-params">(prop, value)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> u.isArray value
    <span class="hljs-keyword">then</span> o[prop] = value[i] <span class="hljs-keyword">for</span> o,i <span class="hljs-keyword">in</span> @; @
    <span class="hljs-keyword">else</span> o[prop] = value <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @; @</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Get the agent with the min/max prop value in the agentset</p>
<pre><code>min = AS.minProp <span class="hljs-string">"y"</span>  <span class="hljs-comment"># 0</span>
max = AS.maxProp <span class="hljs-string">"y"</span>  <span class="hljs-comment"># 4</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  maxProp: <span class="hljs-function"><span class="hljs-params">(prop)</span> -&gt;</span> u.aMax @getProp(prop)
  minProp: <span class="hljs-function"><span class="hljs-params">(prop)</span> -&gt;</span> u.aMin @getProp(prop)
  histOfProp: <span class="hljs-function"><span class="hljs-params">(prop, bin=<span class="hljs-number">1</span>)</span> -&gt;</span> u.histOf @, bin, prop</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h3 id="array-utilities-often-from-util">Array Utilities, often from Util</h3>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Randomize the agentset</p>
<pre><code>AS.shuffle(); AS.getProp <span class="hljs-string">"id"</span> <span class="hljs-comment"># [3, 2, 1, 4, 5]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  shuffle: <span class="hljs-function">-&gt;</span> u.shuffle @</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Sort the agentset by the agent’s <code>id</code>.</p>
<pre><code>AS.shuffle();  AS.getProp <span class="hljs-string">"id"</span>  <span class="hljs-comment"># [3, 2, 1, 4, 5]</span>
AS.sortById(); AS.getProp <span class="hljs-string">"id"</span>  <span class="hljs-comment"># [1, 2, 3, 4, 5]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  sortById: <span class="hljs-function">-&gt;</span> u.sortBy @, <span class="hljs-string">"id"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Make a copy of an agentset, return as new agentset.<br>
NOTE: does <em>not</em> duplicate the objects, simply creates a new agentset
with references to the same agents.  Ex: create a randomized version of AS
but without mangling AS itself:</p>
<pre><code>as = AS.clone().shuffle()
AS.getProp <span class="hljs-string">"id"</span>  <span class="hljs-comment"># [1, 2, 3, 4, 5]</span>
as.getProp <span class="hljs-string">"id"</span>  <span class="hljs-comment"># [2, 4, 0, 1, 3]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  clone: <span class="hljs-function">-&gt;</span> @asSet u.clone @</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Return the last agent in the agentset</p>
<pre><code>AS.last().id             <span class="hljs-comment"># l5</span>
l=AS.last(); p=[l.x,l.y] <span class="hljs-comment"># [1,1]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  last: <span class="hljs-function">-&gt;</span> u.last @</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Returns true if the agentset has any agents</p>
<pre><code>AS.any()  <span class="hljs-comment"># true</span>
AS.getPropWith(<span class="hljs-string">"x"</span>, <span class="hljs-number">99</span>).any() <span class="hljs-comment">#false</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  any: <span class="hljs-function">-&gt;</span> u.any @</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Return an agentset without given agent a</p>
<pre><code>as = AS.clone().other(AS[<span class="hljs-number">0</span>])
as.getProp <span class="hljs-string">"id"</span>  <span class="hljs-comment"># [1, 2, 3, 4]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  other: <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>If simple agentset derived by functions returning agentsets, use
remove. Otherwise iterate over myself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> @isSet()
      u.removeItem @, a
    <span class="hljs-keyword">else</span>
      @asSet (o <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> o <span class="hljs-keyword">isnt</span> a)</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Return random agent in agentset</p>
<pre><code>AS.oneOf()  <span class="hljs-comment"># {id:2,x:6,y:4}</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  oneOf: <span class="hljs-function">-&gt;</span> u.oneOf @</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Return agentset made of n distinct agents</p>
<pre><code>AS.nOf(<span class="hljs-number">3</span>) <span class="hljs-comment"># [{id:0,x:0,y:1}, {id:4,x:1,y:1}, {id:1,x:8,y:0}]</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  nOf: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span> @asSet u.nOf @, n</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Return agent when f(o) min/max in agentset. If multiple agents have
min/max value, return the first. Error if agentset empty.
If f is a string, return element with min/max value of that property.
If “valueToo” then return an array of the agent and the value.</p>
<pre><code>AS.minOneOf(<span class="hljs-string">"x"</span>) <span class="hljs-comment"># {id:0,x:0,y:1}</span>
AS.maxOneOf(<span class="hljs-function"><span class="hljs-params">(a)</span>-&gt;</span>a.x+a.y, <span class="hljs-literal">true</span>) <span class="hljs-comment"># {id:2,x:6,y:4},10</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  minOneOf: <span class="hljs-function"><span class="hljs-params">(f, valueToo=<span class="hljs-literal">false</span>)</span> -&gt;</span> u.minOneOf @, f, valueToo
  maxOneOf: <span class="hljs-function"><span class="hljs-params">(f, valueToo=<span class="hljs-literal">false</span>)</span> -&gt;</span> u.maxOneOf @, f, valueToo</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h3 id="drawing">Drawing</h3>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>For agentsets whose agents have a <code>draw</code> method.
Clears the graphics context (transparent), then
calls each agent’s draw(ctx) method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  draw: <span class="hljs-function"><span class="hljs-params">(ctx)</span> -&gt;</span>
    u.clearCtx(ctx); o.draw(ctx) <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> <span class="hljs-keyword">not</span> o.hidden; <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Show/Hide all of an agentset or breed. Does not redraw.
To show/hide an individual object, set its prototype: o.hidden = bool</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  show: <span class="hljs-function">-&gt;</span> o.hidden = <span class="hljs-literal">false</span> <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @
  hide: <span class="hljs-function">-&gt;</span> o.hidden = <span class="hljs-literal">true</span> <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <h3 id="topology">Topology</h3>

            </div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>For patches &amp; turtles, which have x,y. See Util doc.
Typically a subclass uses a rect/quadtree array to minimize
the size, then uses asSet(array) to call inRadius or inCone</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  inRect: <span class="hljs-function"><span class="hljs-params">(o, radius)</span> -&gt;</span>
    rect = [];
    minX = o.x - radius; maxX = o.x + radius
    minY = o.y - radius; maxY = o.y + radius
    patches = @model.patches</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Is the o +/- radius entirely inside the patches?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    outside = (minX &lt; patches.minX) <span class="hljs-keyword">or</span> (maxX &gt; patches.maxX) <span class="hljs-keyword">or</span>
              (minY &lt; patches.minY) <span class="hljs-keyword">or</span> (maxY &gt; patches.maxY)
    checkTorus = patches.isTorus <span class="hljs-keyword">and</span> outside
    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> @
      x = a.x; y = a.y  <span class="hljs-comment"># agent's x,y</span>
      <span class="hljs-keyword">if</span> checkTorus  <span class="hljs-comment"># Adjust torus x,y if appropriate</span>
        <span class="hljs-keyword">if</span> x&lt;minX <span class="hljs-keyword">then</span> x += patches.numX <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> x&gt;maxX <span class="hljs-keyword">then</span> x -= patches.numX
        <span class="hljs-keyword">if</span> y&lt;minY <span class="hljs-keyword">then</span> y += patches.numY <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> y&gt;maxY <span class="hljs-keyword">then</span> y -= patches.numY</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Test x,y inside rect</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      rect.push a <span class="hljs-keyword">if</span> (minX &lt;= x &lt;= maxX <span class="hljs-keyword">and</span> minY &lt;= y &lt;= maxY)
    @asSet rect</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Return all agents in agentset within d distance from given object.
By default excludes the given object. Uses linear/torus distance
depending on patches.isTorus, and patches width/height if needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  inRadius: <span class="hljs-function"><span class="hljs-params">(o, radius)</span> -&gt;</span>
    d2 = radius * radius; x = o.x; y = o.y
    <span class="hljs-keyword">if</span> @model.patches.isTorus
      w = @model.patches.numX; h = @model.patches.numY
      @asSet (a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> \
        u.torusSqDistance(x, y, a.x, a.y, w, h) &lt;= d2 )
    <span class="hljs-keyword">else</span>
      @asSet (a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> \
        u.sqDistance(x, y, a.x, a.y) &lt;= d2)</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>As above, but also limited to the angle <code>angle</code> around
a <code>heading</code> from object <code>o</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  inCone: <span class="hljs-function"><span class="hljs-params">(o, radius, angle, heading)</span> -&gt;</span>
    x = o.x; y = o.y
    <span class="hljs-keyword">if</span> @model.patches.isTorus
      w = @model.patches.numX; h = @model.patches.numY
      @asSet (a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> \
        u.inTorusCone(radius, angle, heading, x, y, a.x, a.y, w, h))
    <span class="hljs-keyword">else</span>
      @asSet (a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> \
        u.inCone(radius, angle, heading, x, y, a.x, a.y))</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h3 id="debugging">Debugging</h3>

            </div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Useful in console.
Also see <a href="http://goo.gl/1i7bd">CoffeeConsole</a> Chrome extension.</p>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Similar to NetLogo ask &amp; with operators.
Allows functions as strings. Use:</p>
<pre><code>AS.getProp(<span class="hljs-string">"x"</span>) <span class="hljs-comment"># [1, 8, 6, 2, 2]</span>
AS.with(<span class="hljs-string">"o.x&lt;5"</span>).ask(<span class="hljs-string">"o.x=o.x+1"</span>)
AS.getProp(<span class="hljs-string">"x"</span>) <span class="hljs-comment"># [2, 8, 6, 3, 3]</span>

myModel.turtles.with(<span class="hljs-string">"o.id&lt;100"</span>).ask(<span class="hljs-string">"o.color=[255,0,0]"</span>)
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  ask: <span class="hljs-function"><span class="hljs-params">(f)</span> -&gt;</span>
    eval(<span class="hljs-string">"f=function(o){return "</span>+f+<span class="hljs-string">";}"</span>) <span class="hljs-keyword">if</span> u.isString f
    f(o) <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @; @
  with: <span class="hljs-function"><span class="hljs-params">(f)</span> -&gt;</span>
    eval(<span class="hljs-string">"f=function(o){return "</span>+f+<span class="hljs-string">";}"</span>) <span class="hljs-keyword">if</span> u.isString f
    @asSet (o <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">when</span> f(o))</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>The example agentset AS used in the code fragments was made like this,
slightly more useful than shown above due to the toString method.</p>
<pre><code><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">XY</span></span>
  constructor: <span class="hljs-function"><span class="hljs-params">(@x,@y)</span> -&gt;</span>
  toString: <span class="hljs-function">-&gt;</span> <span class="hljs-string">"{id:<span class="hljs-subst">#{@id}</span>,x:<span class="hljs-subst">#{@x}</span>,y:<span class="hljs-subst">#{@y}</span>}"</span>
@AS = <span class="hljs-keyword">new</span> ABM.AgentSet <span class="hljs-comment"># @ =&gt; global name space</span>
</code></pre><p>The result of</p>
<pre><code>AS.add <span class="hljs-keyword">new</span> XY(u.randomInt(<span class="hljs-number">10</span>), u.randomInt(<span class="hljs-number">10</span>)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span><span class="hljs-number">.5</span>]
</code></pre><p>random run, captured so we can reuse.</p>
<pre><code>AS.add <span class="hljs-keyword">new</span> XY(pt...) <span class="hljs-keyword">for</span> pt <span class="hljs-keyword">in</span> [[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">8</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">6</span>,<span class="hljs-number">4</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]]
</code></pre>
            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
